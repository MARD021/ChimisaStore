<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AnimeFC - Tu portal de anime y películas</title>
  
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  
  <script src="https://js.stripe.com/v3/"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js" defer></script>

  <style id="app-style">
    /* Fuente Poppins */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Poppins', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    
    /* Variables de Color (Dark/Light Mode) */
    .dark {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --accent-color: #8257e6;
    }
    
    .light {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --text-primary: #121212;
      --text-secondary: #505050;
      --accent-color: #6c47d1;
    }
    
    /* Estilos de Tarjeta Anime (Hover) */
    .anime-card {
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .anime-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    /* Carousel mejorado con scroll-snap */
    .carousel { scroll-behavior: smooth; scrollbar-width: none; }
    .carousel::-webkit-scrollbar { display: none; }
    
    /* Overlay para Banners */
    .banner-overlay {
      background: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.4) 50%, rgba(0, 0, 0, 0.1) 100%);
    }
    
    /* Spinner de Carga */
    .loading-spinner { border-top-color: var(--accent-color); animation: spinner 0.8s linear infinite; }
    @keyframes spinner { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
    
    /* Efecto Shimmer para placeholders (esqueletos) */
    .shimmer {
      background: linear-gradient(90deg, var(--bg-secondary) 0%, rgba(255,255,255,0.1) 50%, var(--bg-secondary) 100%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
    
    /* Estilos de Scrollbar Personalizado */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 10px; }
    
    /* Badge Premium */
    .premium-badge {
      background: gold;
      color: black;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 12px;
      margin-left: 6px;
    } 
 </style>
</head>
<body
  x-data="app()"
  x-init="init()"
  :class="darkMode ? 'dark bg-[--bg-primary] text-[--text-primary]' : 'light bg-[--bg-primary] text-[--text-primary]'"
>

  <div x-show="isLoading" class="fixed inset-0 flex items-center justify-center z-50 bg-[--bg-primary]">
    <div class="loading-spinner w-16 h-16 border-4 border-[--bg-secondary] border-solid rounded-full"></div>
  </div>

  <div x-show="showLogin"
     x-transition.opacity
     x-trap.noscroll="showLogin"
     class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
    <div @click.outside="showLogin = false"
         class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl max-w-sm w-full relative transform transition-all">
        
        <h2 class="text-3xl font-bold text-center text-gray-900 dark:text-white mb-6">Iniciar Sesión</h2>
        <p class="text-center text-gray-600 dark:text-gray-400 mb-8">
            Accede a todo el contenido exclusivo de AnimeFC.
        </p>

        <button @click="login('Google')" 
                :disabled="isLoading"
                class="w-full flex items-center justify-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-lg font-semibold bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition duration-150">
            <i class="fab fa-google text-red-500 mr-3"></i>
            <span x-text="isLoading ? 'Cargando...' : 'Continuar con Google'"></span>
        </button>

        <button @click="showLogin = false"
                class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>
</div>

  <div x-show="showDetail" x-cloak 
       class="fixed inset-0 z-50 flex flex-col"
       @click.self="closeContentDetail()">
    <div class="relative w-full h-full overflow-y-auto bg-[--bg-primary]"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
         
      <div x-show="currentContent" class="relative">
        <button @click="closeContentDetail()" 
                class="absolute top-4 left-4 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/80 transition">
          <i class="fas fa-arrow-left"></i>
        </button>
        
        <div class="relative h-[60vh] md:h-[70vh] w-full bg-cover bg-center"
             :style="`background-image: url('${currentContent?.bannerImage}')`">
          <div class="banner-overlay absolute inset-0"></div>
          <div class="absolute bottom-0 left-0 p-6 md:p-10 w-full">
            <h1 class="text-3xl md:text-5xl font-bold mb-2 text-white" x-text="currentContent?.title"></h1>
            <div class="flex items-center mb-4">
              <span class="bg-[--accent-color] text-white px-2 py-0.5 rounded text-sm mr-3">
                <i class="fas fa-star mr-1"></i>
                <span x-text="currentContent?.rating"></span>/10
              </span>
              <span class="text-white/90 text-sm mr-3" x-text="currentContent?.year"></span>
              <span class="text-white/90 text-sm" x-text="currentContent?.duration"></span>
              <span x-show="currentContent?.isPremium" class="premium-badge">Premium</span>
            </div>
            <p class="text-white/90 max-w-2xl mb-6" x-text="currentContent?.description"></p>
            <button
              @click="playCurrent()"
              class="bg-[--accent-color] hover:opacity-90 transition text-white py-3 px-8 rounded-lg font-medium flex items-center">
              <i class="fas fa-play mr-2"></i> Reproducir
            </button>
          </div>
        </div>
        
        <div x-show="currentContent?.seasons?.length" class="p-6 md:p-10">
          <h2 class="text-2xl font-bold mb-6">Episodios</h2>
          
          <div class="mb-6">
            <select
              x-model.number="currentSeasonIndex"
              class="bg-[--bg-secondary] text-[--text-primary] py-2 px-4 rounded-lg border border-[--accent-color]/30 focus:border-[--accent-color] outline-none">
              <template x-for="(s, si) in currentContent.seasons" :key="si">
                <option :value="si" x-text="s.name"></option>
              </template>
            </select>
          </div>
          
          <div class="grid gap-4">
            <template x-for="(ep, i) in currentContent.seasons[currentSeasonIndex]?.episodes" :key="i">
              <div class="flex items-center bg-[--bg-secondary] rounded-lg overflow-hidden hover:scale-[1.01] transition">
                <div class="w-36 h-20 bg-cover bg-center" 
                     :style="`background-image: url('${ep.image || currentContent?.thumbnail}')`"></div>
                <div class="p-4 flex-1">
                  <h3 class="font-medium" x-text="`Episodio ${ep.number}: ${ep.title}`"></h3>
                  <p class="text-sm text-[--text-secondary]" x-text="ep.length"></p>
                  <span x-show="ep.streams && ep.streams.length > 0" class="text-xs text-[--accent-color] mt-1">
                      <i class="fas fa-globe mr-1"></i>
                      <span x-text="ep.streams.map(s => s.type).join(', ')"></span>
                  </span>
                </div>
                <div class="pr-4">
                  <button class="text-[--accent-color] hover:text-[--text-primary] p-2" @click="openPlayerFromDetail(ep)">
                    <i class="fas fa-play"></i>
                  </button>
                </div>
              </div>
            </template>
          </div>
        </div>
        
        <div class="p-6 md:p-10">
          <h2 class="text-2xl font-bold mb-6">Información</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-[--text-secondary] mb-2">Géneros</h3>
              <p x-text="currentContent?.genres?.join(', ')"></p>
            </div>
            <div>
              <h3 class="text-[--text-secondary] mb-2">Estudio</h3>
              <p x-text="currentContent?.studio"></p>
            </div>
            <div>
              <h3 class="text-[--text-secondary] mb-2">Director</h3>
              <p x-text="currentContent?.director"></p>
            </div>
            <div>
              <h3 class="text-[--text-secondary] mb-2">Idiomas</h3>
              <p>Japonés, Español Latino, Español (España), Inglés</p>
            </div>
          </div>
        </div>
        
        <div class="p-6 md:p-10">
          <h2 class="text-2xl font-bold mb-6">Recomendaciones</h2>
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            <template x-for="i in 5" :key="i">
              <div class="anime-card rounded-lg overflow-hidden cursor-pointer">
                <div class="aspect-[2/3] bg-cover bg-center" 
                     style="background-image: url('https://cdn.pixabay.com/photo/2023/05/19/17/01/anime-8005750_960_720.jpg')"></div>
                <div class="p-2">
                  <p class="font-medium truncate">Anime recomendado</p>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div x-show="showPlayer" x-cloak class="fixed inset-0 z-[60] bg-black/80 flex items-center justify-center p-4" @click.self="closePlayer()">
    <div class="w-full max-w-5xl bg-[--bg-secondary] rounded-xl overflow-hidden shadow-2xl relative">
      
      <button @click="closePlayer()" class="absolute top-3 right-3 bg-black/50 text-white p-2 rounded-full hover:bg-black/80 z-20">
        <i class="fas fa-times"></i>
      </button>

      <div x-show="currentContentPlaying" class="absolute top-0 left-0 right-0 p-3 bg-black/50 text-white z-10 flex justify-between items-center">
        <div>
          <p class="font-bold truncate" x-text="currentContentPlaying.title"></p>
          <p class="text-sm" 
             x-text="currentContentPlaying ? `S${currentSeasonIndex + 1}: E${currentContentPlaying.seasons[currentSeasonIndex]?.episodes[currentEpisodeIndex]?.number}` : ''"></p>
        </div>
        </div>
      <div class="w-full aspect-video">
        <iframe :src="playerSrc" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
      </div>
      
      <div class="flex justify-between items-center p-3 bg-black/90 text-white flex-wrap"> 
        <button @click="playPreviousEpisode()"
                :disabled="currentEpisodeIndex === 0"
                :class="{'opacity-50 cursor-not-allowed': currentEpisodeIndex === 0}"
                class="bg-[--accent-color] hover:opacity-90 transition text-white py-2 px-3 rounded-lg font-medium flex items-center">
            <i class="fas fa-backward mr-1 sm:mr-2"></i> 
            <span class="hidden sm:inline">Anterior</span>
        </button>

        <p class="text-sm font-medium hidden sm:block truncate flex-grow text-center px-4" 
           x-text="currentContentPlaying ? `S${currentSeasonIndex + 1}: E${currentContentPlaying.seasons[currentSeasonIndex]?.episodes[currentEpisodeIndex]?.number} - ${currentContentPlaying.seasons[currentSeasonIndex]?.episodes[currentEpisodeIndex]?.title}` : ''">
        </p>

        <div class="flex items-center space-x-2">
            <div x-show="currentEpisodeStreams.length > 0">
              <select
                x-model.number="currentStreamIndex"
                @change="changeStream($event.target.value)"
                class="bg-black/70 text-white py-2 px-3 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[--accent-color] outline-none">
                <template x-for="(stream, si) in currentEpisodeStreams" :key="si">
                  <option :value="si" x-text="`${stream.language} (${stream.type})`"></option>
                </template>
              </select>
            </div>
            <button @click="playNextEpisode()"
                    :disabled="currentEpisodeIndex >= (currentContentPlaying?.seasons[currentSeasonIndex]?.episodes?.length - 1)"
                    :class="{'opacity-50 cursor-not-allowed': currentEpisodeIndex >= (currentContentPlaying?.seasons[currentSeasonIndex]?.episodes?.length - 1)}"
                    class="bg-[--accent-color] hover:opacity-90 transition text-white py-2 px-3 rounded-lg font-medium flex items-center">
                <span class="hidden sm:inline">Siguiente</span>
                <i class="fas fa-forward ml-1 sm:ml-2"></i>
            </button>
        </div>
      </div>
      </div>
  </div>
  
  <div x-show="showAdPreRoll" x-cloak
       class="fixed inset-0 bg-black/90 flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg text-center max-w-4xl w-full mx-auto"> 
      <h2 class="text-lg font-bold mb-4 text-white">Anuncio</h2>
      <p class="mb-4 text-white/80">Tu video empezará después del anuncio</p>
      
      <template x-if="showAdPreRoll">
        <div class="w-full max-w-[728px] mx-auto h-[90px] mb-4 flex items-center justify-center bg-gray-900 rounded-lg overflow-hidden">
          <script type="text/javascript">
	      atOptions = {
		    'key' : '6fbec16bd03f6f46b32ac55f09c93140',
		    'format' : 'iframe',
		    'height' : 90,
		    'width' : 728,
		    'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/6fbec16bd03f6f46b32ac55f09c93140/invoke.js"></script>
        </div>
      </template>
      <div class="text-sm text-gray-400">
        <span x-text="`El contenido comenzará en ${adCountdown} segundos...`"></span>
      </div>

    </div>
  </div>
  <header class="fixed top-0 left-0 right-0 z-40 bg-[--bg-primary] shadow-md">
    <div class="container mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <a href="javascript:void(0)" @click="currentView = 'home'" class="text-2xl font-bold text-[--accent-color]">
            Anime<span class="text-red-500">FC</span>
          </a>
        </div>
        
        <nav class="hidden md:flex items-center space-x-6">
          <a href="javascript:void(0)" @click="currentView = 'home'" class="font-medium hover:text-[--accent-color] transition"
             :class="currentView === 'home' ? 'text-[--accent-color]' : ''"> Inicio </a>
          <a href="javascript:void(0)" @click="currentView = 'movies'" class="font-medium hover:text-[--accent-color] transition"
             :class="currentView === 'movies' ? 'text-[--accent-color]' : ''"> Películas </a>
          <a href="javascript:void(0)" @click="currentView = 'series'" class="font-medium hover:text-[--accent-color] transition"
             :class="currentView === 'series' ? 'text-[--accent-color]' : ''"> Anime </a>

          <a href="javascript:void(0)" @click="currentView = 'dramas'" class="font-medium hover:text-[--accent-color] transition"
             :class="currentView === 'dramas' ? 'text-[--accent-color]' : ''"> Dramas </a>
          <a href="javascript:void(0)" @click="currentView = 'telenovelas'" class="font-medium hover:text-[--accent-color] transition"
             :class="currentView === 'telenovelas' ? 'text-[--accent-color]' : ''"> Telenovelas </a>
          <a href="javascript:void(0)" @click="currentView = 'cartoons'" class="font-medium hover:text-[--accent-color] transition"
             :class="currentView === 'cartoons' ? 'text-[--accent-color]' : ''"> Caricaturas </a>
          <div class="relative">
            <input 
              type="text" 
              placeholder="Buscar animes..." 
              class="py-2 px-4 pr-10 bg-[--bg-secondary] rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-[--accent-color]"
              x-model="searchQuery"
            >
            <i class="fas fa-search absolute right-3 top-2.5 text-[--text-secondary]"></i>
          </div>
        </nav>
        
        <div class="flex items-center space-x-4">
          <button @click="toggleDarkMode()" class="p-2 rounded-full hover:bg-[--bg-secondary]">
            <i :class="darkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
          </button>
          
          <template x-if="!isLoggedIn">
            <button @click="showLogin = true" class="hidden sm:flex items-center px-4 py-2 bg-[--accent-color] hover:opacity-90 transition text-white rounded-lg">
              <i class="fas fa-sign-in-alt mr-2"></i> Iniciar Sesión
            </button>
          </template>
          
          <template x-if="isLoggedIn">
            <div class="relative" x-data="{ showUserMenu: false }">
              <button @click="showUserMenu = !showUserMenu" class="flex items-center focus:outline-none">
                <img :src="currentUser?.avatar" alt="Avatar" class="w-9 h-9 rounded-full object-cover">
                <span class="hidden sm:block ml-2" x-text="currentUser?.name"></span>
                <i class="fas fa-chevron-down ml-2 text-xs"></i>
              </button>
              
              <div x-show="showUserMenu" @click.away="showUserMenu = false" 
                   class="absolute right-0 mt-2 w-48 bg-[--bg-secondary] rounded-lg shadow-lg py-2 z-50"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 transform scale-95"
                   x-transition:enter-end="opacity-100 transform scale-100"
                   x-transition:leave="transition ease-in duration-150"
                   x-transition:leave-start="opacity-100 transform scale-100"
                   x-transition:leave-end="opacity-0 transform scale-95">
                <div class="px-4 py-2 border-b border-[--text-secondary]/10">
                  <p class="font-medium" x-text="currentUser?.name"></p>
                  <p class="text-sm text-[--text-secondary]" x-text="currentUser?.email"></p>
                </div>
                <a href="javascript:void(0)" @click="currentView = 'profile'; showUserMenu = false" class="block px-4 py-2 hover:bg-[--accent-color]/10">
                  <i class="fas fa-user mr-2"></i> Mi Perfil
                </a>
                <a href="javascript:void(0)" @click="currentView = 'watchlist'; showUserMenu = false" class="block px-4 py-2 hover:bg-[--accent-color]/10">
                  <i class="fas fa-bookmark mr-2"></i> Mi Lista
                </a>
                <a href="javascript:void(0)" @click="logout()" class="block px-4 py-2 text-red-500 hover:bg-red-500/10">
                  <i class="fas fa-sign-out-alt mr-2"></i> Cerrar Sesión
                </a>
              </div>
            </div>
          </template>
          
          <button @click="showMobileSearch = !showMobileSearch; showMobileMenu = false" class="md:hidden p-2">
            <i class="fas fa-search"></i>
          </button>
          
          <button @click="showMobileMenu = !showMobileMenu; showMobileSearch = false" class="md:hidden p-2">
            <i :class="showMobileMenu ? 'fas fa-times' : 'fas fa-bars'"></i>
          </button>
          </div>
      </div>
      
      <div x-show="showMobileSearch" x-transition class="pt-3 pb-2 md:hidden">
        <div class="relative">
          <input 
            type="text" 
            placeholder="Buscar animes..." 
            class="w-full py-2 px-4 pr-10 bg-[--bg-secondary] rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-[--accent-color]"
            x-model="searchQuery"
          >
          <i class="fas fa-search absolute right-3 top-2.5 text-[--text-secondary]"></i>
        </div>
      </div>
      
    </div>
    
    <div x-show="showMobileMenu" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-[-10px]"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 translate-y-[-10px]"
         @click.away="showMobileMenu = false"
         class="md:hidden bg-[--bg-primary] shadow-lg absolute top-full left-0 right-0 z-40 p-4 border-t border-[--bg-secondary]">
        <nav class="flex flex-col space-y-3">
            <a href="javascript:void(0)" @click="currentView = 'home'; showMobileMenu = false" class="font-medium hover:text-[--accent-color] transition"
                 :class="currentView === 'home' ? 'text-[--accent-color]' : ''"> Inicio </a>
            <a href="javascript:void(0)" @click="currentView = 'movies'; showMobileMenu = false" class="font-medium hover:text-[--accent-color] transition"
                 :class="currentView === 'movies' ? 'text-[--accent-color]' : ''"> Películas </a>
            <a href="javascript:void(0)" @click="currentView = 'series'; showMobileMenu = false" class="font-medium hover:text-[--accent-color] transition"
                 :class="currentView === 'series' ? 'text-[--accent-color]' : ''"> Anime </a>
            <a href="javascript:void(0)" @click="currentView = 'dramas'; showMobileMenu = false" class="font-medium hover:text-[--accent-color] transition"
                 :class="currentView === 'dramas' ? 'text-[--accent-color]' : ''"> Dramas </a>
            <a href="javascript:void(0)" @click="currentView = 'telenovelas'; showMobileMenu = false" class="font-medium hover:text-[--accent-color] transition"
                 :class="currentView === 'telenovelas' ? 'text-[--accent-color]' : ''"> Telenovelas </a>
            <a href="javascript:void(0)" @click="currentView = 'cartoons'; showMobileMenu = false" class="font-medium hover:text-[--accent-color] transition"
                 :class="currentView === 'cartoons' ? 'text-[--accent-color]' : ''"> Caricaturas </a>
        </nav>
    </div>
    </header>

  <main class="pt-16 pb-16">
    
    <div x-show="currentView === 'home'">
      
      <div class="relative h-[60vh] md:h-[80vh] bg-cover bg-center" 
           style="background-image: url('https://cdn.pixabay.com/photo/2021/11/04/05/33/sakura-6767889_960_720.jpg')">
        <div class="banner-overlay absolute inset-0"></div>
        <div class="absolute bottom-0 left-0 p-6 md:p-10 w-full">
          <span class="inline-block bg-red-600 text-white px-2 py-0.5 rounded text-sm mb-4">DESTACADO</span>
          <h1 class="text-3xl md:text-5xl font-bold mb-2 text-white">Nuevo Anime Exclusivo</h1>
          <p class="text-white/90 max-w-2xl mb-6">Sumérgete en un mundo lleno de magia y aventura. Disponible ahora en estreno exclusivo solo para miembros premium.</p>
          <div class="flex flex-wrap gap-3">
            <button @click="showContentDetail(sampleFeatured)"
              class="bg-[--accent-color] hover:opacity-90 transition text-white py-3 px-8 rounded-lg font-medium flex items-center">
              <i class="fas fa-play mr-2"></i> Reproducir
            </button>
            <button class="bg-white/20 backdrop-blur-sm hover:bg-white/30 transition text-white py-3 px-8 rounded-lg font-medium flex items-center">
              <i class="fas fa-info-circle mr-2"></i> Más Info
            </button>
          </div>
        </div>
      </div>
      
      <section class="py-8 px-6 relative"> <h2 class="text-2xl font-bold mb-6">Tendencias</h2>
        
        <button @click="$refs.trendingCarousel.scrollBy({ left: -560, behavior: 'smooth' })" 
                class="hidden lg:block absolute left-4 top-1/2 mt-4 transform -translate-y-1/2 z-30 p-3 bg-black/50 text-white rounded-full hover:bg-[--accent-color] transition">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <button @click="$refs.trendingCarousel.scrollBy({ left: 560, behavior: 'smooth' })" 
                class="hidden lg:block absolute right-4 top-1/2 mt-4 transform -translate-y-1/2 z-30 p-3 bg-black/50 text-white rounded-full hover:bg-[--accent-color] transition">
            <i class="fas fa-chevron-right"></i>
        </button>

        <div x-ref="trendingCarousel" class="carousel flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory">
          <template x-for="item in filtered(trendingList)" :key="item.title">
            <div @click="showContentDetail(item)" class="anime-card flex-shrink-0 w-[280px] rounded-lg overflow-hidden cursor-pointer snap-start">
              <div class="relative aspect-video bg-cover bg-center" 
                   :style="`background-image: url('${item.thumbnail}')`">
                <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                  <i class="fas fa-star text-yellow-500 mr-1"></i>
                  <span x-text="item.rating"></span>
                </div>
              </div>
              <div class="p-3">
                <h3 class="font-medium truncate flex items-center gap-2">
                <span x-text="item.title"></span>
                <span x-show="item.isPremium" class="premium-badge">Premium</span>
                </h3>
                <p class="text-sm text-[--text-secondary]" x-text="item.type === 'movie' ? 'Película' : `${item.seasons.length} temporadas`"></p>
              </div>
            </div>
          </template>
        </div>
      </section>
      
      
      <section class="py-8 px-6 relative">
        <h2 class="text-2xl font-bold mb-6">Recién Agregados</h2>
        
        <button @click="$refs.recentCarousel.scrollBy({ left: -560, behavior: 'smooth' })" 
                class="hidden lg:block absolute left-4 top-1/2 mt-4 transform -translate-y-1/2 z-30 p-3 bg-black/50 text-white rounded-full hover:bg-[--accent-color] transition">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <button @click="$refs.recentCarousel.scrollBy({ left: 560, behavior: 'smooth' })" 
                class="hidden lg:block absolute right-4 top-1/2 mt-4 transform -translate-y-1/2 z-30 p-3 bg-black/50 text-white rounded-full hover:bg-[--accent-color] transition">
            <i class="fas fa-chevron-right"></i>
        </button>

        <div x-ref="recentCarousel" class="carousel flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory">
          <template x-for="item in filtered(recentAdded)" :key="item.title">
            <div @click="showContentDetail(item)" class="anime-card flex-shrink-0 w-[180px] rounded-lg overflow-hidden cursor-pointer snap-start">
              <div class="relative aspect-[2/3] bg-cover bg-center" 
                   :style="`background-image: url('${item.bannerImage}')`">
                <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                  <i class="fas fa-star text-yellow-500 mr-1"></i>
                  <span x-text="item.rating"></span>
                </div>
              </div>
              <div class="p-2">
                <h3 class="font-medium truncate" x-text="item.title"></h3>
                <p class="text-sm text-[--text-secondary]" x-text="item.type === 'movie' ? 'Película' : 'Serie'"></p>
              </div>
            </div>
          </template>
        </div>
      </section>
      </div>

    <div x-show="currentView === 'profile'" class="container mx-auto px-6 pt-8">
      <h1 class="text-3xl font-bold mb-8">Mi Perfil</h1>
      <div class="bg-[--bg-secondary] rounded-xl p-6 mb-8">
        <div class="flex flex-col md:flex-row md:items-center">
          <img :src="currentUser?.avatar" alt="Avatar" class="w-24 h-24 rounded-full object-cover mb-4 md:mb-0 md:mr-6">
          <div>
            <h2 class="text-2xl font-bold" x-text="currentUser?.name"></h2>
            <p class="text-[--text-secondary]" x-text="currentUser?.email"></p>
            <div class="mt-2">
              <span class="inline-block bg-yellow-500 text-black px-3 py-1 rounded-full text-sm font-semibold">
                <i class="fas fa-crown mr-1"></i>
                <span x-text="currentUser?.subscription"></span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div x-show="currentView === 'watchlist'" class="container mx-auto px-6 pt-8">
      <h1 class="text-3xl font-bold mb-8">Mi Lista</h1>
      </div>

    <div x-show="currentView === 'movies'" class="container mx-auto px-6 pt-8">
      <h1 class="text-3xl font-bold mb-6">Películas</h1>
      <div class="flex flex-wrap gap-2 mb-6">
        <button class="bg-[--accent-color] text-white px-4 py-1 rounded-full text-sm">Todos</button>
        <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Acción</button>
        <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Romance</button>
        <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Fantasía</button>
        <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Comedia</button>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <template x-for="item in filtered(featuredMovies)" :key="item.title">
          <div @click="showContentDetail(item)" class="anime-card rounded-lg overflow-hidden cursor-pointer">
            <div class="relative aspect-[2/3] bg-cover bg-center" 
                 :style="`background-image: url('${item.bannerImage}')`">
              <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                <i class="fas fa-star text-yellow-500 mr-1"></i>
                <span x-text="item.rating"></span>
              </div>
            </div>
            <div class="p-2">
              <h3 class="font-medium truncate" x-text="item.title"></h3>
              <p class="text-sm text-[--text-secondary]" x-text="item.year"></p>
            </div>
          </div>
        </template>
      </div>
    </div>

    <div x-show="currentView === 'series'" class="container mx-auto px-6 pt-8">
        <h1 class="text-3xl font-bold mb-6">Todas las Series de Anime</h1>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
          <template x-for="item in filtered(trendingList)" :key="item.title">
            <div @click="showContentDetail(item)" class="anime-card rounded-lg overflow-hidden cursor-pointer">
              <div class="relative aspect-[2/3] bg-cover bg-center" 
                   :style="`background-image: url('${item.bannerImage}')`">
                <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                  <i class="fas fa-star text-yellow-500 mr-1"></i>
                  <span x-text="item.rating"></span>
                </div>
              </div>
              <div class="p-2">
                <h3 class="font-medium truncate" x-text="item.title"></h3>
                <p class="text-sm text-[--text-secondary]" x-text="item.year"></p>
              </div>
            </div>
          </template>
        </div>
      </div>
    
    <div x-show="currentView === 'dramas'" class="container mx-auto px-6 pt-8">
        <h1 class="text-3xl font-bold mb-6">Dramas Asiáticos (K-Dramas, C-Dramas)</h1>
        <div class="flex flex-wrap gap-2 mb-6">
            <button class="bg-[--accent-color] text-white px-4 py-1 rounded-full text-sm">Todos</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">K-Dramas</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">C-Dramas</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Romance</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Históricos</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Thriller</button>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
          <template x-for="item in filtered(asianDramas)" :key="item.title">
            <div @click="showContentDetail(item)" class="anime-card rounded-lg overflow-hidden cursor-pointer">
              <div class="relative aspect-[2/3] bg-cover bg-center" 
                   :style="`background-image: url('${item.bannerImage}')`">
                <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                  <i class="fas fa-star text-yellow-500 mr-1"></i>
                  <span x-text="item.rating"></span>
                </div>
              </div>
              <div class="p-2">
                <h3 class="font-medium truncate" x-text="item.title"></h3>
                <p class="text-sm text-[--text-secondary]" x-text="item.year"></p>
              </div>
            </div>
          </template>
        </div>
    </div>

    <div x-show="currentView === 'telenovelas'" class="container mx-auto px-6 pt-8">
        <h1 class="text-3xl font-bold mb-6">Telenovelas y Series Latinas</h1>
        <div class="flex flex-wrap gap-2 mb-6">
            <button class="bg-[--accent-color] text-white px-4 py-1 rounded-full text-sm">Todos</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Melodrama Clásico</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Narco Series / Thriller</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Juveniles</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Dramas Turcos</button>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
          <template x-for="item in filtered(telenovelas)" :key="item.title">
            <div @click="showContentDetail(item)" class="anime-card rounded-lg overflow-hidden cursor-pointer">
              <div class="relative aspect-[2/3] bg-cover bg-center" 
                   :style="`background-image: url('${item.bannerImage}')`">
                <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                  <i class="fas fa-star text-yellow-500 mr-1"></i>
                  <span x-text="item.rating"></span>
                </div>
              </div>
              <div class="p-2">
                <h3 class="font-medium truncate" x-text="item.title"></h3>
                <p class="text-sm text-[--text-secondary]" x-text="item.year"></p>
              </div>
            </div>
          </template>
        </div>
    </div>

    <div x-show="currentView === 'cartoons'" class="container mx-auto px-6 pt-8">
        <h1 class="text-3xl font-bold mb-6">Caricaturas y Animación Occidental</h1>
        <div class="flex flex-wrap gap-2 mb-6">
            <button class="bg-[--accent-color] text-white px-4 py-1 rounded-full text-sm">Todos</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Animación para Adultos</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Aventura y Fantasía</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Comedia Infantil</button>
            <button class="bg-[--bg-secondary] hover:bg-[--accent-color] hover:text-white transition px-4 py-1 rounded-full text-sm">Superhéroes</button>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
          <template x-for="item in filtered(cartoons)" :key="item.title">
            <div @click="showContentDetail(item)" class="anime-card rounded-lg overflow-hidden cursor-pointer">
              <div class="relative aspect-[2/3] bg-cover bg-center" 
                   :style="`background-image: url('${item.bannerImage}')`">
                <div class="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-xs">
                  <i class="fas fa-star text-yellow-500 mr-1"></i>
                  <span x-text="item.rating"></span>
                </div>
              </div>
              <div class="p-2">
                <h3 class="font-medium truncate" x-text="item.title"></h3>
                <p class="text-sm text-[--text-secondary]" x-text="item.year"></p>
              </div>
            </div>
          </template>
        </div>
    </div>
    </main>
      <footer class="bg-[--bg-secondary] text-[--text-secondary] py-8 mt-12">
    <div class="container mx-auto px-6">
      <div class="flex flex-wrap justify-between items-center">
        <div class="w-full md:w-auto mb-6 md:mb-0">
          <p class="text-xl font-bold text-[--accent-color]">Anime<span class="text-red-500">FC</span></p>
          <p class="text-sm mt-2">© 2024 AnimeFC. Todos los derechos reservados.</p>
        </div>
        
        <div class="flex space-x-6">
          <a href="#" class="hover:text-[--accent-color] transition"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="hover:text-[--accent-color] transition"><i class="fab fa-twitter"></i></a>
          <a href="#" class="hover:text-[--accent-color] transition"><i class="fab fa-instagram"></i></a>
          <a href="#" class="hover:text-[--accent-color] transition"><i class="fab fa-youtube"></i></a>
        </div>
        
        <nav class="w-full md:w-auto mt-6 md:mt-0 space-x-4 flex">
          <a href="#" class="hover:text-[--accent-color] transition text-sm">Términos de Uso</a>
          <a href="#" class="hover:text-[--accent-color] transition text-sm">Política de Privacidad</a>
          <a href="#" class="hover:text-[--accent-color] transition text-sm">Ayuda</a>
        </nav>
      </div>
    </div>
  </footer>
  
  <script src="https://fpyf8.com/88/tag.min.js" data-zone="134930" async data-cfasync="false"></script>
  <script>(function(s){s.dataset.zone='9042941',s.src='https://forfrogadiertor.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
  <script>
    // --------------------- 6.1: CONFIGURACIÓN Y UTILIDADES ---------------------
    
    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAUp-kfeoWJyct54qvmMjBf9MtnOXD0Oz0",
      authDomain: "animefc-21.firebaseapp.com",
      projectId: "animefc-21",
      storageBucket: "animefc-21.firebasestorage.app",
      messagingSenderId: "479473502931",
      appId: "1:479473502931:web:a9f1f28cc3ce2bdbeb2226",
      measurementId: "G-2RYV83D2KJ"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Constantes de la Aplicación
    const EMBED_URL = 'https://bingezove.com/embed/';
    const imgGenEp = "https://cdn.pixabay.com/photo/2021/05/23/18/43/anime-6277258_960_720.jpg";

    // Funciones para Generación de Datos de Prueba
    // ✅ MODIFICADO: Nueva función para generar streams
    const genStreams = (isMovie = false) => [
        { language: 'Japonés', type: 'Sub Español', url: EMBED_URL + (isMovie ? 'movie-sub' : 'sub-ep') },
        { language: 'Español', type: 'Latino', url: EMBED_URL + (isMovie ? 'movie-latino' : 'latino-ep') },
        { language: 'Español', type: 'Castellano', url: EMBED_URL + (isMovie ? 'movie-cast' : 'cast-ep') },
    ];
    
    // ✅ MODIFICADO: genEpisodes usa ahora 'streams' en lugar de 'embedUrl'
    const genEpisodes = (count) =>
      Array.from({length: count}, (_, i) => ({
        number: i + 1,
        title: 'Título del episodio ' + (i + 1),
        length: '24 min',
        streams: genStreams(), 
        image: imgGenEp 
      }));
      
    const genSeasons = (nSeasons = 2, eps = 12) =>
      Array.from({length: nSeasons}, (_, s) => ({
        name: 'Temporada ' + (s + 1),
        episodes: genEpisodes(eps)
      }));
      
    // ✅ MODIFICADO: movieSeason usa ahora 'streams'
    const movieSeason = (title = 'Película', length = '120 min') => ({
      name: 'Película',
      episodes: [{ 
          number: 1, 
          title, 
          length, 
          streams: genStreams(true), // Usar el generador de streams para películas
          image: imgGenEp 
      }]
    });

    // URLs de Imágenes de Prueba
    const imgOnePiece     = "https://m.media-amazon.com/images/S/pv-target-images/5c57390c319ef27a7ecb1336ce2fa8d70dc93f814e95530e9302d696ea50c6c8.jpg";
    const imgAOT          = "https://m.media-amazon.com/images/M/MV5BN2EzYTYyNGUtOTE2ZS00ZTljLWE5M2EtZDViYjhmYzgwNThhXkEyXkFqcGc@._V1_.jpg";
    const imgAOT1         = "https://img.asmedia.epimg.net/resizer/v2/K7ZGKKC34NFB5L6QGU3NGIJJTY.jpg?auth=89c60d6947dc848c626183f6c5c56bd6c155b77a1968e9941ece745e028b1dab&width=644&height=362&smart=true"
    const imgDemon        = "https://demonslayer-hinokami.sega.com/img/purchase/digital-deluxe-es.jpg";
    const imgMovie        = "https://www.lavanguardia.com/peliculas-series/images/movie/poster/1991/3/w1280/iCySGAWNMk0BETBGAK3xNOKTkX5.jpg";
    const imgFMA          = "https://cdn.pixabay.com/photo/2021/01/30/12/20/anime-5966735_960_720.jpg";
    const imgDeathNote    = "https://cdn.pixabay.com/photo/2017/08/30/02/14/death-note-2698983_960_720.jpg";
    const imgHaikyuu      = "https://cdn.pixabay.com/photo/2020/05/16/14/51/anime-5172780_960_720.jpg";
    const imgTokyoGhoul   = "https://cdn.pixabay.com/photo/2022/03/01/08/53/anime-7041235_960_720.jpg";
    const imgSAO          = "https://cdn.pixabay.com/photo/2019/08/01/04/25/anime-4377154_960_720.jpg";
    const imgBlackClover  = "https://cdn.pixabay.com/photo/2021/12/13/11/55/anime-6866468_960_720.jpg";
    const imgFairyTail    = "https://cdn.pixabay.com/photo/2019/08/14/06/25/fairy-tail-4405217_960_720.jpg";
    const imgBlueLock     = "https://cdn.pixabay.com/photo/2022/12/05/06/59/anime-7635727_960_720.jpg";
    const imgSpyFamily    = "https://cdn.pixabay.com/photo/2022/11/29/23/18/anime-7625801_960_720.jpg";
    const imghorii      = "IMG/Nota-Opinion-Horimiya-edit.jpg";
    const imghori         = "IMG/horimiya-season-one-finale.jpg"
    // --------------------- 6.2: LISTAS DE CONTENIDO (DATOS DE PRUEBA) ---------------------

    // ✅ MODIFICADO: Se agregan más entradas a trendingList para poblar mejor la vista 'series'
    const trendingList = [
      { 
        title:'Horimiya', 
        type:'Anime', 
        rating:'9.2', 
        year:'2021', 
        duration:'24 min/ep', 
        bannerImage: imghori, 
        thumbnail: imghorii, 
        description: 'Horimiya es un anime y manga que sigue la historia de dos estudiantes de preparatoria con identidades ocultas',
        genres:['Romance','Aventura'], 
        studio:'CloverWorks', 
        director:'Masashi Ishihama', 
        seasons: [ 
          { 
            name: "Temporada 1", 
            episodes:  [
          { number: 1 , title: "Un rayo de luz", length: "24 min", 
            streams: [
              { language: "Japonés", type: "Sub Español", url: "https://bingezove.com/embed/hn1g7a7ly4hq" },
              { language: "Español", type: "Latino", url: EMBED_URL + 'horimiya-ep1-lat' },
              { language: "Inglés", type: "Sub Inglés", url: EMBED_URL + 'horimiya-ep1-eng' },
            ]},
          { number: 2 , title: "La amistad de Izumi y Hori", length: "24 min", 
            streams: [
              { language: "Japonés", type: "Sub Español", url: "https://bingezove.com/embed/yjn9k52cs45h" },
              { language: "Español", type: "Latino", url: EMBED_URL + 'horimiya-ep2-lat' },
            ]},
          { number: 3 , title: "Episodio 3", length: "24 min", streams: genStreams()},
          { number: 4 , title: "Episodio 4", length: "24 min", streams: genStreams()},
          { number: 5 , title: "Episodio 5", length: "24 min", streams: genStreams()},
          { number: 6 , title: "Episodio 6", length: "24 min", streams: genStreams()},
          { number: 7 , title: "Episodio 7", length: "24 min", streams: genStreams()},
          { number: 8 , title: "Episodio 8", length: "24 min", streams: genStreams()},
          { number: 9 , title: "Episodio 9", length: "24 min", streams: genStreams()},
          { number:10 , title: "Episodio 10", length: "24 min", streams: genStreams()},
          { number:11 , title: "Episodio 11", length: "24 min", streams: genStreams()},
          { number:12 , title: "Episodio 12", length: "24 min", streams: genStreams()},
          { number:13 , title: "Episodio 13 (Final)", length: "24 min", streams: genStreams()},
        ]
          }, 
          //{ name: "Temporada 2", episodes: genEpisodes(12) }
        ]
      }, 
      { title:'Demon Slayer', type:'serie', rating:'9.0', year:'2019', duration:'24 min/ep', bannerImage: imgDemon, thumbnail: imgDemon, genres:['Acción','Fantasía'], studio:'Ufotable', director:'Haruo Sotozaki', seasons: genSeasons(3, 11), description: 'Tanjiro se une al Cuerpo de Cazadores de Demonios para vengar a su familia y curar a su hermana.'},
      // Nuevas series de Anime añadidas
      { title:'Attack on Titan', type:'serie', rating:'9.1', year:'2013', duration:'24 min/ep', bannerImage: imgAOT, thumbnail: imgAOT1, genres:['Acción','Militar'], studio:'MAPPA', director:'Tetsurō Araki', seasons: genSeasons(4, 16), description: 'La humanidad lucha por sobrevivir contra los Titanes.'},
      { title:'One Piece', type:'serie', rating:'9.4', year:'1999', duration:'24 min/ep', bannerImage: imgOnePiece, thumbnail: imgOnePiece, genres:['Aventura','Shonen'], studio:'Toei Animation', director:'Kônosuke Uda', seasons: genSeasons(20, 25), description: 'Luffy y su tripulación buscan el One Piece para convertirse en el Rey de los Piratas.'},
      { title:'Fullmetal Alchemist', type:'serie', rating:'9.1', year:'2009', duration:'24 min/ep', bannerImage: imgFMA, thumbnail: imgFMA, genres:['Fantasía','Ciencia Ficción'], studio:'Bones', director:'Yasuhiro Irie', seasons: genSeasons(1, 64), description: 'Dos hermanos buscan la Piedra Filosofal para recuperar sus cuerpos.'},
      { title:'Death Note', type:'serie', rating:'9.0', year:'2006', duration:'23 min/ep', bannerImage: imgDeathNote, thumbnail: imgDeathNote, genres:['Misterio','Thriller'], studio:'Madhouse', director:'Tetsurō Araki', seasons: genSeasons(1, 37), description: 'Un estudiante encuentra un cuaderno que le permite matar a cualquiera cuyo nombre escriba.'},
      { title:'Haikyuu!!', type:'serie', rating:'8.7', year:'2014', duration:'24 min/ep', bannerImage: imgHaikyuu, thumbnail: imgHaikyuu, genres:['Deportes','Comedia'], studio:'Production I.G', director:'Susumu Mitsunaka', seasons: genSeasons(4, 25), description: 'Shoyo Hinata se une al club de voleibol para convertirse en el mejor jugador.'},
      { title:'Tokyo Ghoul', type:'serie', rating:'8.0', year:'2014', duration:'24 min/ep', bannerImage: imgTokyoGhoul, thumbnail: imgTokyoGhoul, genres:['Terror','Gore'], studio:'Pierrot', director:'Shuhei Morita', seasons: genSeasons(4, 12), description: 'Un estudiante se convierte en un híbrido humano-Ghoul.'},
      { title:'Sword Art Online', type:'serie', rating:'7.6', year:'2012', duration:'24 min/ep', bannerImage: imgSAO, thumbnail: imgSAO, genres:['Acción','Videojuegos'], studio:'A-1 Pictures', director:'Tomohiko Itō', seasons: genSeasons(3, 25), description: 'Jugadores quedan atrapados en un juego de realidad virtual donde morir en el juego significa morir en la vida real.'},
      { title:'Black Clover', type:'serie', rating:'7.8', year:'2017', duration:'23 min/ep', bannerImage: imgBlackClover, thumbnail: imgBlackClover, genres:['Magia','Acción'], studio:'Pierrot', director:'Tatsuya Yoshihara', seasons: genSeasons(1, 170), description: 'Un joven sin magia aspira a ser el Rey Mago.'},
      { title:'Fairy Tail', type:'serie', rating:'8.0', year:'2009', duration:'24 min/ep', bannerImage: imgFairyTail, thumbnail: imgFairyTail, genres:['Fantasía','Aventura'], studio:'A-1 Pictures', director:'Shinji Ishihira', seasons: genSeasons(9, 51), description: 'Las aventuras del gremio de magos Fairy Tail.'},
      { title:'Blue Lock', type:'serie', rating:'8.4', year:'2022', duration:'24 min/ep', bannerImage: imgBlueLock, thumbnail: imgBlueLock, genres:['Deportes','Fútbol'], studio:'8bit', director:'Tetsuaki Watanabe', seasons: genSeasons(1, 24), description: 'Jóvenes delanteros compiten por un lugar en la selección nacional de fútbol de Japón.'},
      { title:'Spy x Family', type:'serie', rating:'8.6', year:'2022', duration:'24 min/ep', bannerImage: imgSpyFamily, thumbnail: imgSpyFamily, genres:['Comedia','Espías'], studio:'WIT Studio', director:'Kazuhiro Furuhashi', seasons: genSeasons(2, 12), description: 'Un espía, una asesina y una telépata forman una familia falsa para cumplir sus misiones.'},
    ];

    const popularSeries = trendingList.slice(2, 9);
    
    // ✅ NUEVO: Lista de Dramas Asiáticos
    const asianDramas = [
        { title:'Crash Landing on You', type:'drama', rating:'9.0', year:'2019', duration:'70 min/ep', bannerImage: imgFMA, thumbnail: imgFMA, genres:['Romance','K-Drama'], studio:'Studio Dragon', director:'Lee Jeong-hyo', seasons: genSeasons(1, 16), description: 'Una heredera de Corea del Sur aterriza accidentalmente en Corea del Norte.'},
        { title:'Vincenzo (Premium)', type:'drama', rating:'8.7', year:'2021', duration:'80 min/ep', bannerImage: imgAOT, thumbnail: imgAOT, genres:['Crimen','Thriller'], studio:'Studio Dragon', director:'Kim Hee-won', seasons: genSeasons(1, 20), isPremium: true, description: 'Un abogado de la mafia regresa a Corea y lucha contra un conglomerado corrupto.'},
        { title:'Goblin', type:'drama', rating:'8.9', year:'2016', duration:'80 min/ep', bannerImage: imgDemon, thumbnail: imgDemon, genres:['Fantasía','Romance'], studio:'Hwa&Dam Pictures', director:'Lee Eung-bok', seasons: genSeasons(1, 16), description: 'Un ser inmortal busca a su novia humana para terminar con su maldición.'},
        { title:'Put Your Head on My Shoulder', type:'drama', rating:'8.3', year:'2019', duration:'45 min/ep', bannerImage: imgTokyoGhoul, thumbnail: imgTokyoGhoul, genres:['Comedia','C-Drama'], studio:'Tencent Penguin Pictures', director:'Zhi Wei', seasons: genSeasons(1, 24), description: 'Una estudiante de contabilidad y un genio de la física terminan viviendo juntos.'},
    ];

    // ✅ NUEVO: Lista de Telenovelas
    const telenovelas = [
        { title:'La Reina del Flow', type:'telenovela', rating:'7.5', year:'2018', duration:'45 min/ep', bannerImage: imgOnePiece, thumbnail: imgOnePiece, genres:['Melodrama','Música'], studio:'Caracol Televisión', director:'Liliana Bocanegra', seasons: genSeasons(2, 82), description: 'Una compositora busca venganza contra el hombre que la traicionó.'},
        { title:'El Señor de los Cielos', type:'telenovela', rating:'7.9', year:'2013', duration:'45 min/ep', bannerImage: imgBlackClover, thumbnail: imgBlackClover, genres:['Narco Serie','Acción'], studio:'Telemundo', director:'Varios', seasons: genSeasons(7, 80), description: 'La vida de un narcotraficante que busca reemplazar su rostro.'},
        { title:'Pasión de Gavilanes', type:'telenovela', rating:'8.1', year:'2003', duration:'45 min/ep', bannerImage: imgHaikyuu, thumbnail: imgHaikyuu, genres:['Romance','Clásico'], studio:'Telemundo', director:'Rodrigo Triana', seasons: genSeasons(2, 188), description: 'Tres hermanos buscan vengar la muerte de su hermana.'},
        { title:'Mi Vida (Turca)', type:'telenovela', rating:'8.0', year:'2014', duration:'60 min/ep', bannerImage: imgSpyFamily, thumbnail: imgSpyFamily, genres:['Drama','Turca'], studio:'Fox Türkiye', director:'Sadullah Celen', seasons: genSeasons(4, 131), description: 'La vida de Bahar, una joven de origen humilde.'},
    ];

    // ✅ NUEVO: Lista de Caricaturas
    const cartoons = [
        { title:'Rick y Morty', type:'cartoon', rating:'9.2', year:'2013', duration:'22 min/ep', bannerImage: imgDeathNote, thumbnail: imgDeathNote, genres:['Comedia','Adultos'], studio:'Adult Swim', director:'Varios', seasons: genSeasons(7, 10), description: 'Las aventuras de un genio científico y su nieto ansioso.'},
        { title:'Avatar: La Leyenda de Aang', type:'cartoon', rating:'9.3', year:'2005', duration:'23 min/ep', bannerImage: imgBlueLock, thumbnail: imgBlueLock, genres:['Aventura','Fantasía'], studio:'Nickelodeon', director:'Varios', seasons: genSeasons(3, 20), description: 'Aang, el último maestro aire, debe salvar al mundo.'},
        { title:'Un Show Más', type:'cartoon', rating:'8.4', year:'2010', duration:'11 min/ep', bannerImage: imgSAO, thumbnail: imgSAO, genres:['Comedia','Infantil'], studio:'Cartoon Network Studios', director:'J.G. Quintel', seasons: genSeasons(8, 40), description: 'Las surrealistas y cómicas desventuras de Mordecai y Rigby.'},
        { title:'Young Justice', type:'cartoon', rating:'8.7', year:'2010', duration:'23 min/ep', bannerImage: imgFairyTail, thumbnail: imgFairyTail, genres:['Superhéroes','Acción'], studio:'Warner Bros. Animation', director:'Varios', seasons: genSeasons(4, 26), description: 'Los compañeros adolescentes de los héroes de la Liga de la Justicia forman su propio equipo.'},
    ];


    const featuredMovies = [
      { title:'Pelicula 1', type:'movie', rating:'8.5', year:'2023', duration:'120 min', bannerImage: imgMovie, thumbnail: imgMovie, genres:['Acción'], director:'Director A', seasons: [movieSeason('Pelicula 1', '120 min')] },
      { title:'Pelicula 2 (Premium)', type:'movie', rating:'8.8', year:'2022', duration:'110 min', bannerImage: imgDemon, thumbnail: imgDemon, genres:['Fantasía'], director:'Director B', isPremium: true, seasons: [movieSeason('Pelicula 2', '110 min')] },
      { title:'Pelicula 3', type:'movie', rating:'7.9', year:'2021', duration:'95 min', bannerImage: imgAOT1, thumbnail: imgAOT1, genres:['Comedia'], director:'Director C', seasons: [movieSeason('Pelicula 3', '95 min')] },
      { title:'Pelicula 4', type:'movie', rating:'8.1', year:'2020', duration:'135 min', bannerImage: imgOnePiece, thumbnail: imgOnePiece, genres:['Drama'], director:'Director D', seasons: [movieSeason('Pelicula 4', '135 min')] },
    ];
    // Se usa la lista de series y dramas para las secciones secundarias
    const recentAdded = trendingList.slice(6, 11).concat(featuredMovies.slice(0, 2)).concat(asianDramas.slice(0, 1)); 
    const sampleFeatured = trendingList[0];


    // --------------------- 6.3: FUNCIÓN PRINCIPAL DE ALPINE.JS ---------------------
    function app(){
      return {
        // --- 6.3.1: ESTADO DE LA APLICACIÓN ---
        darkMode: true,
        isLoggedIn: false,
        currentUser: { name: '', email: '', avatar: '', subscription: 'Gratis' }, 
        currentView: 'home', 
        showLogin: false,
        showDetail: false,
        currentContent: null,
        currentSeasonIndex: 0,
        searchQuery: '',
        isLoading: true,
        showPlayer: false,
        playerSrc: '',
        pendingPlayerSrc: '',
        showMobileSearch: false, // Estado para la búsqueda móvil
        showMobileMenu: false, // ✅ CORRECCIÓN: Estado para el menú de categorías móvil
        // ESTADOS DEL REPRODUCTOR
        currentContentPlaying: null, 
        currentEpisodeIndex: -1,
        // ✅ NUEVOS ESTADOS para la selección de streams
        currentEpisodeStreams: [],
        currentStreamIndex: 0, 

        // START AD REFACTOR: NEW STATES
        adDurationInSeconds: 5, 
        adCountdown: 5,
        // END AD REFACTOR: NEW STATES
        
        // --- 6.3.2: PROPIEDADES DE DATOS ---
        trendingList,
        popularSeries,
        featuredMovies,
        recentAdded,
        sampleFeatured,
        // ✅ NUEVOS ARREGLOS DE CONTENIDO
        asianDramas, 
        telenovelas,
        cartoons, 
        
        // --- 6.3.3: MÉTODOS DE UI Y CONTROL ---
        toggleDarkMode() {
          this.darkMode = !this.darkMode;
          localStorage.setItem('darkMode', this.darkMode);
          document.body.classList.remove(this.darkMode ? 'light' : 'dark');
          document.body.classList.add(this.darkMode ? 'dark' : 'light');
        },
        closePlayer() {
          this.showPlayer = false;
          this.playerSrc = '';
          // Resetear estados del stream
          this.currentContentPlaying = null;
          this.currentEpisodeIndex = -1;
          this.currentEpisodeStreams = [];
          this.currentStreamIndex = 0; 
        },

        endAd(){
          this.showAdPreRoll = false;
          // ✅ MODIFICADO: La URL se obtiene del stream seleccionado
          this.playerSrc = this.currentEpisodeStreams[this.currentStreamIndex]?.url || ''; 
          this.showPlayer = true; 
        },
        
        // ✅ NUEVO: Lógica centralizada para iniciar el anuncio y el contador
        startAd() {
            this.adCountdown = this.adDurationInSeconds;
            this.showPlayer = false; 
            this.showAdPreRoll = true;
            
            const interval = setInterval(() => {
                this.adCountdown--;
                if (this.adCountdown <= 0) {
                    clearInterval(interval);
                    this.endAd();
                }
            }, 1000);
        },

        // ✅ NUEVO: Método para cambiar el stream/idioma
        changeStream(newStreamIndex) {
            this.currentStreamIndex = parseInt(newStreamIndex); // Asegurar que sea número
            const selectedStream = this.currentEpisodeStreams[this.currentStreamIndex];
            
            if (!selectedStream) return;

            // Reiniciar el reproductor con el nuevo stream
            this.pendingPlayerSrc = selectedStream.url;

            // Simular el anuncio y luego reproducir
            this.startAd(); // MODIFICADO: Llamada a startAd()
        },

        // --- 6.3.4: MÉTODOS DE CONTENIDO ---
        showContentDetail(content) {
          this.currentContent = content;
          this.currentSeasonIndex = 0;
          this.showDetail = true;
        },
        closeContentDetail() {
          this.showDetail = false;
          this.currentContent = null;
        },
        
        playCurrent() {
          // Reproduce el primer episodio de la primera temporada (o la película)
          const firstEpisode = this.currentContent?.type === 'movie' 
            ? this.currentContent.seasons[0].episodes[0] 
            : this.currentContent?.seasons?.[0]?.episodes?.[0];
          
          if (firstEpisode) {
              const seasonIndex = this.currentContent?.type === 'movie' ? 0 : 0;
              const episodeIndex = 0;

              this.openPlayer(this.currentContent, seasonIndex, episodeIndex);
          }
        },

        // Nuevo método genérico para iniciar el reproductor
        openPlayer(content, seasonIndex, episodeIndex) {
          this.currentContentPlaying = content;
          this.currentSeasonIndex = seasonIndex;
          this.currentEpisodeIndex = episodeIndex;

          const episode = content.seasons[seasonIndex].episodes[episodeIndex];
          // ✅ MODIFICADO: Cargar streams y seleccionar el primero
          this.currentEpisodeStreams = episode.streams || []; 
          this.currentStreamIndex = 0; 
          
          if(this.currentEpisodeStreams.length === 0) {
              alert('Error: Este episodio no tiene fuentes de video configuradas.');
              return;
          }

          this.pendingPlayerSrc = this.currentEpisodeStreams[this.currentStreamIndex].url;

          this.showDetail = true;
          // Simula anuncio pre-roll
          this.startAd(); // MODIFICADO: Llamada a startAd()
        },

        
        // Nuevo método para llamar openPlayer desde la lista de detalles
        openPlayerFromDetail(episode) {
             if (!this.currentContent || this.currentSeasonIndex === -1) return;

             const episodeList = this.currentContent.seasons[this.currentSeasonIndex].episodes;
             // Buscar el índice del episodio que se hizo clic (comparando el número de episodio para simplificar)
             const index = episodeList.findIndex(e => e.number === episode.number);
             
             if (index !== -1) {
                this.openPlayer(this.currentContent, this.currentSeasonIndex, index);
             }
        },

        // ✅ MODIFICADO: playNextEpisode actualiza los estados de stream
        playNextEpisode() {
            if (!this.currentContentPlaying) return;

            const currentEpisodes = this.currentContentPlaying.seasons[this.currentSeasonIndex].episodes;
            if (this.currentEpisodeIndex < currentEpisodes.length - 1) {
                this.currentEpisodeIndex++;
                const nextEpisode = currentEpisodes[this.currentEpisodeIndex];
                
                this.currentEpisodeStreams = nextEpisode.streams || []; 
                this.currentStreamIndex = 0; 
                
                if(this.currentEpisodeStreams.length === 0) {
                    alert('Error: El siguiente episodio no tiene fuentes de video.');
                    this.closePlayer();
                    return;
                }

                this.pendingPlayerSrc = this.currentEpisodeStreams[this.currentStreamIndex].url; 
                this.startAd(); // MODIFICADO: Llamada a startAd()
            }
        },

        // ✅ MODIFICADO: playPreviousEpisode actualiza los estados de stream
        playPreviousEpisode() {
            if (!this.currentContentPlaying) return;

            if (this.currentEpisodeIndex > 0) {
                this.currentEpisodeIndex--;
                const previousEpisode = this.currentContentPlaying.seasons[this.currentSeasonIndex].episodes[this.currentEpisodeIndex];

                this.currentEpisodeStreams = previousEpisode.streams || []; 
                this.currentStreamIndex = 0; 
                
                if(this.currentEpisodeStreams.length === 0) {
                    alert('Error: El episodio anterior no tiene fuentes de video.');
                    this.closePlayer();
                    return;
                }
                
                this.pendingPlayerSrc = this.currentEpisodeStreams[this.currentStreamIndex].url; 
                this.startAd(); // MODIFICADO: Llamada a startAd()
            }
        },
        
        // --- 6.3.5: MÉTODOS DE BÚSQUEDA ---
        filtered(list) {
          const q = this.searchQuery.toLowerCase();
          if (!q) return list;
          return list.filter(x => x.title.toLowerCase().includes(q));
        },
        
        // --- 6.3.6: MÉTODOS DE AUTENTICACIÓN (FIREBASE) ---
        async login(method) {
            // Se fuerza el proveedor a Google
            if (method !== 'Google') {
                alert('Solo el inicio de sesión con Google está habilitado.');
                return;
            }

            this.isLoading = true;
            this.showLogin = false;

            try {
                const providerInstance = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(providerInstance);
                alert('¡Inicio de sesión con Google exitoso! 🚀');

            } catch (error) {
                console.error("Error en el login:", error.code, error.message);
                alert("Error al iniciar sesión: " + (error.message.includes('auth/popup-closed-by-user') ? 'Ventana de popup cerrada' : error.message));
            } finally {
                this.isLoading = false;
            }
        },

        async logout() {
            this.isLoading = true;
            try {
                await auth.signOut(); 
                alert('Sesión cerrada correctamente.');
            } catch (error) {
                console.error("Error al cerrar sesión:", error);
                alert("Error al cerrar sesión.");
            } finally {
                this.isLoading = false;
                this.currentView = 'home';
            }
        },
        
        subscribe(plan) {
            // Lógica de suscripción simulada
            alert(`Intentando suscribir a ${this.currentUser.name} al plan ${plan}... (Funcionalidad de pago deshabilitada)`);
            this.currentView = 'home';
        },

        // --- 6.3.7: MÉTODO DE INICIALIZACIÓN ---
        init() {
            // Inicializar Dark Mode desde localStorage
            this.darkMode = localStorage.getItem('darkMode') !== 'false';
            document.body.classList.add(this.darkMode ? 'dark' : 'light');
            
            // Escuchar el estado de autenticación de Firebase
            auth.onAuthStateChanged(user => {
                if (user) {
                    this.isLoggedIn = true;
                    
                    // Rellenar currentUser con datos de Firebase
                    this.currentUser = {
                        name: user.displayName || user.email.split('@')[0],
                        email: user.email,
                        avatar: user.photoURL || 'https://i.pinimg.com/736x/4f/62/d2/4f62d2bc39cb6092fe4dedb978c285c5.jpg',
                        subscription: 'Gratis' // Se mantiene 'Gratis' por defecto
                    };
                } else {
                    this.isLoggedIn = false;
                    // Resetear currentUser al desloguearse
                    this.currentUser = { name: '', email: '', avatar: '', subscription: 'Gratis' };
                }
                this.isLoading = false; // Detener la pantalla de carga inicial
            });
        }
      };
    }
  </script>
</body>
</html>
